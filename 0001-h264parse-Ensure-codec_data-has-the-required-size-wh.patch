From 38c20972b843f200af22ab9206b1aa64605a8a04 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Sebastian=20Dr=C3=B6ge?= <sebastian@centricular.com>
Date: Wed, 23 Nov 2016 10:51:17 +0200
Subject: [PATCH 1/4] h264parse: Ensure codec_data has the required size when
 reading number of SPS

https://bugzilla.gnome.org/show_bug.cgi?id=774896
---
 gst/videoparsers/gsth264parse.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/gst/videoparsers/gsth264parse.c b/gst/videoparsers/gsth264parse.c
index 506cd61..36cfb69 100644
--- a/gst/videoparsers/gsth264parse.c
+++ b/gst/videoparsers/gsth264parse.c
@@ -1942,6 +1942,10 @@ gst_h264_parse_set_caps (GstBaseParse * parse, GstCaps * caps)
       off = nalu.offset + nalu.size;
     }
 
+    if (off >= size) {
+      gst_buffer_unmap (codec_data, &map);
+      goto avcc_too_small;
+    }
     num_pps = data[off];
     off++;
 
-- 
2.9.3

